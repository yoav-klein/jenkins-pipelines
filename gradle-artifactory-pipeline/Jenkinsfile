node {
    cleanWs()
    checkout scm
    
    dir('gradle-artifactory-pipeline') {

        sh script: 'chmod +x tcp-client/gradlew'

        def server = Artifactory.server('artifactory')

        def rtGradle = Artifactory.newGradleBuild()
        rtGradle.useWrapper = true
        rtGradle.deployer server: server, repo: 'my-maven'

        def buildInfo = rtGradle.run rootDir: "tcp-client/", buildFile: 'build.gradle', tasks: 'clean artifactoryPublish'

        server.publishBuildInfo buildInfo
        

    }
}